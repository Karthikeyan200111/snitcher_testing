<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Welcome to our website. Discover quality content and services tailored for you.">
    <meta name="keywords" content="website, content, services, quality">
    <meta name="author" content="Your Name">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="Welcome to My Page">
    <meta property="og:description" content="Welcome to our website. Discover quality content and services tailored for you.">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Welcome to My Page">
    <meta name="twitter:description" content="Welcome to our website. Discover quality content and services tailored for you.">
    <title>Welcome to My Page | Premium Services & Content</title>
    <link rel="canonical" href="https://yourwebsite.com/">

    <!-- Snitcher + Spotter setup -->
    <script>
        // Spotter callback
        function myCallback(identification) {
            if (identification && identification.type !== "isp") {
                const company = (identification.data || identification.company || identification);
                window.identifiedCompany = {
                    name: company.name || company.company_name || '',
                    domain: company.domain || company.website || '',
                    industry: company.industry || company.sector || '',
                    employee_range: company.size || company.employee_range || company.employees || '',
                    location: company.location || company.country || ''
                };

                if (typeof populateSpotterFieldsFromIdentification === 'function') {
                    try { populateSpotterFieldsFromIdentification(identification); } catch(e) {}
                } else {
                    try {
                        const set = (id, val) => { const el = document.getElementById(id); if (el) el.value = val || ''; };
                        set('snitcher_company_name', window.identifiedCompany.name);
                        set('snitcher_company_domain', window.identifiedCompany.domain);
                        set('snitcher_company_industry', window.identifiedCompany.industry);
                        set('snitcher_company_size', window.identifiedCompany.employee_range);
                        set('snitcher_company_country', window.identifiedCompany.location);
                        set('snitcher_spotter_source', 'spotter');
                    } catch(e) {}
                }
            }
        }

        window.SpotterSettings = {
            token: "1651|EwgkEyJJyhrVTXLFRnogxVwC9NQhIJFQMhq8xE3Wc313ed8f",
            callback: myCallback
        };
    </script>

    <script>
    !function(e){"use strict";var t=e&&e.namespace;if(t&&e.profileId&&e.cdn){var i=window[t];if(i&&Array.isArray(i)||(i=window[t]=[]),!i.initialized&&!i._loaded)if(i._loaded)console&&console.warn("[Radar] Duplicate initialization attempted");else{i._loaded=!0;["track","page","identify","group","alias","ready","debug","on","off","once","trackClick","trackSubmit","trackLink","trackForm","pageview","screen","reset","register","setAnonymousId","addSourceMiddleware","addIntegrationMiddleware","addDestinationMiddleware","giveCookieConsent"].forEach((function(e){var a;i[e]=(a=e,function(){var e=window[t];if(e.initialized)return e[a].apply(e,arguments);var i=[].slice.call(arguments);return i.unshift(a),e.push(i),e})})),-1===e.apiEndpoint.indexOf("http")&&(e.apiEndpoint="https://"+e.apiEndpoint),i.bootstrap=function(){var t,i=document.createElement("script");i.async=!0,i.type="text/javascript",i.id="__radar__",i.setAttribute("data-settings",JSON.stringify(e)),i.src=[-1!==(t=e.cdn).indexOf("http")?"":"https://",t,"/releases/latest/radar.min.js"].join("");var a=document.scripts[0];a.parentNode.insertBefore(i,a)},i.bootstrap()}}else"undefined"!=typeof console&&console.error("[Radar] Configuration incomplete")}({
        "apiEndpoint": "radar.snitcher.com",
        "cdn": "cdn.snitcher.com",
        "namespace": "Snitcher",
        "profileId": "sXi76h3EJT",
        features: {
            formTracking: true,
            clickTracking: true,
            downloadTracking: true,
        }
    });

    // Request Spotter when ready
    (function(){
        try{
            if (window.Snitcher && typeof window.Snitcher.ready === 'function') {
                window.Snitcher.ready(async function(){
                    try{
                        if (typeof window.Snitcher.getSpotterIdentification === 'function'){
                            const ident = await window.Snitcher.getSpotterIdentification();
                            console.log('Spotter (ready):', ident);
                            if (ident?.success) populateSpotterFieldsFromIdentification?.(ident);
                            else if (ident?.type) window.SpotterSettings?.callback?.(ident);
                            return;
                        }
                        // fallback polling
                        let tries = 0;
                        const iv = setInterval(async () => {
                            tries++;
                            if (typeof window.Snitcher.getSpotterIdentification === 'function'){
                                clearInterval(iv);
                                const ident = await window.Snitcher.getSpotterIdentification();
                                console.log('Spotter (poll):', ident);
                                if (ident?.success) populateSpotterFieldsFromIdentification?.(ident);
                                else if (ident?.type) window.SpotterSettings?.callback?.(ident);
                            } else if (tries > 10) clearInterval(iv);
                        }, 400);
                    }catch(e){ console.warn('Spotter init error', e); }
                });
            }
        }catch(e){ console.warn('Spotter inline init failed', e); }
    })();
    </script>

    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background-color: #f5f5f5; }
        h1 { color: #333; }
        .button-container { margin-top: 30px; display: flex; gap: 10px; flex-wrap: wrap; }
        button { padding: 10px 20px; font-size: 14px; border: none; border-radius: 4px; cursor: pointer; background-color: #007bff; color: white; transition: background-color 0.3s; }
        button:hover { background-color: #0056b3; }
        button:active { background-color: #004085; }
        #status { margin-top: 20px; padding: 10px; background-color: white; border-radius: 4px; border-left: 4px solid #007bff; }
        .section { margin-top: 40px; padding: 20px; background-color: white; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .section h2 { margin-top: 0; color: #333; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
        input[type="text"], input[type="email"], textarea { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; font-family: Arial, sans-serif; }
        textarea { resize: vertical; min-height: 60px; }
        .signup-section { max-width: 620px; margin: 20px auto; }
        .form-card { padding: 24px; border-radius: 8px; background: #fff; box-shadow: 0 2px 6px rgba(0,0,0,0.06); }
        .form-row { margin-bottom: 14px; }
        .input-label { display:block; margin-bottom:6px; color:#555; font-size:14px }
        .text-input { width:100%; padding:12px 14px; border-radius:8px; border:1px solid #e6e6e6; font-size:15px; box-sizing:border-box }
        .text-input.invalid { border-color:#e74c3c; }
        .error-message { color:#e74c3c; font-size:13px; margin-top:6px; display:none }
        .error-message.visible { display:block }
        .submit-primary { display:block; width:100%; padding:14px 18px; border-radius:10px; background:#0f5132; color:#fff; font-weight:700; border:none; font-size:16px; cursor:pointer }
        .muted { color:#6c757d; font-size:13px; margin-top:12px; text-align:center }
        .event-log { background-color: #f9f9f9; border: 1px solid #ddd; border-radius: 4px; padding: 10px; max-height: 200px; overflow-y: auto; margin-top: 10px; }
        .log-entry { padding: 5px; border-bottom: 1px solid #eee; font-size: 12px; color: #666; }
        .log-entry:last-child { border-bottom: none; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
    </style>
</head>
<body>
    <h1>Welcome to My Page</h1>
    <p>This is a basic HTML page with Snitcher tracking integration.</p>
    
    <div id="status"></div>

    <!-- Signup Form -->
    <div class="section signup-section">
        <div class="form-card">
            <h2>Sign up</h2>
            <form id="signupForm" novalidate>
                <div class="form-row">
                    <label class="input-label" for="fullname">Full name</label>
                    <input id="fullname" name="fullname" class="text-input" placeholder="" value="" />
                    <div id="fullnameError" class="error-message">Please enter your name.</div>
                </div>
                <div class="form-row">
                    <label class="input-label" for="email">Email</label>
                    <input id="email" name="email" type="email" class="text-input" placeholder="Email" />
                    <div id="emailError" class="error-message">Please enter a valid email address.</div>
                </div>
                <div class="form-row">
                    <label class="input-label" for="password">Password</label>
                    <input id="password" name="password" type="password" class="text-input" placeholder="Password" />
                    <div id="passwordError" class="error-message">Please create a strong password.</div>
                </div>
                <button type="submit" class="submit-primary">Start</button>
                <button type="button" onclick="logSpotterDebug()" style="margin-top:10px; padding:8px 12px;">Debug Spotter</button>

                <!-- Hidden fields for company data -->
                <input type="hidden" name="snitcher_company_name"    id="snitcher_company_name">
                <input type="hidden" name="snitcher_company_domain"  id="snitcher_company_domain">
                <input type="hidden" name="snitcher_company_industry"id="snitcher_company_industry">
                <input type="hidden" name="snitcher_company_size"    id="snitcher_company_size">
                <input type="hidden" name="snitcher_company_country" id="snitcher_company_country">
                <input type="hidden" name="snitcher_spotter_source"  id="snitcher_spotter_source">
            </form>
        </div>
    </div>

    <!-- ────────────────────────────────────────────── -->
    <!-- The rest of your sections (tracking buttons, etc.) -->
    <!-- ────────────────────────────────────────────── -->

    <div class="section">
        <h2>Basic Event Tracking</h2>
        <div class="button-container">
            <button onclick="trackPageView()">Track Page View</button>
            <button onclick="trackCustomEvent()">Track Custom Event</button>
            <button onclick="trackButtonClick()">Track Button Click</button>
        </div>
    </div>

    <div class="section">
        <h2>User Identification</h2>
        <input type="text" id="userId" placeholder="User ID (e.g., user_123)" value="user_123">
        <input type="text" id="userName" placeholder="User Name" value="Test User">
        <input type="email" id="userEmail" placeholder="User Email" value="test@example.com">
        <input type="text" id="userPlan" placeholder="User Plan" value="premium">
        <div class="button-container">
            <button onclick="identifyUserCustom()">Identify User</button>
            <button onclick="resetUser()">Reset User</button>
        </div>
    </div>

    <div class="section">
        <h2>Custom Event Tracking</h2>
        <input type="text" id="eventName" placeholder="Event Name" value="user_signup">
        <textarea id="eventData" placeholder="Event Data (JSON format)">{"signup_method": "email", "source": "homepage"}</textarea>
        <div class="button-container">
            <button onclick="trackCustomEventWithData()">Track Custom Event</button>
            <button onclick="trackPurchase()">Track Purchase Event</button>
            <button onclick="trackPageInteraction()">Track Page Interaction</button>
        </div>
    </div>

    <div class="section">
        <h2>User Actions</h2>
        <div class="button-container">
            <button onclick="trackFormSubmit()">Track Form Submit</button>
            <button onclick="trackLinkClick()">Track Link Click</button>
            <button onclick="trackVideoPlay()">Track Video Play</button>
            <button onclick="trackDownload()">Track Download</button>
            <button onclick="trackShare()">Track Share</button>
        </div>
    </div>

    <div class="section">
        <h2>Event Log</h2>
        <div class="button-container">
            <button onclick="clearEventLog()">Clear Log</button>
        </div>
        <div id="eventLog" class="event-log">
            <div class="log-entry">Event log will appear here...</div>
        </div>
    </div>

    <script>
        // ──────────────────────────────────────────────
        // Shared helpers
        // ──────────────────────────────────────────────
        let eventLog = [];

        function addToLog(message, type = 'success') {
            const ts = new Date().toLocaleTimeString();
            eventLog.unshift(`[${ts}] ${message}`);
            if (eventLog.length > 50) eventLog.pop();
            renderEventLog();
        }

        function renderEventLog() {
            const div = document.getElementById('eventLog');
            if (!div) return;
            if (eventLog.length === 0) {
                div.innerHTML = '<div class="log-entry">Event log is empty</div>';
            } else {
                div.innerHTML = eventLog.map(e => `<div class="log-entry"><span class="success">✓</span> ${e}</div>`).join('');
            }
        }

        function clearEventLog() {
            eventLog = [];
            renderEventLog();
            updateStatus('Event log cleared');
        }

        function updateStatus(message) {
            const el = document.getElementById('status');
            if (el) el.textContent = '✓ ' + message + ' — ' + new Date().toLocaleTimeString();
        }

        // ──────────────────────────────────────────────
        // Spotter population
        // ──────────────────────────────────────────────
        function populateSpotterFieldsFromIdentification(identification) {
            if (!identification) return;

            const comp = (identification.data?.company || identification.data || identification.company || identification);

            const name    = comp.name || comp.company_name || '';
            const domain  = comp.domain || comp.website || '';
            const industry= comp.industry || comp.sector || '';
            const size    = comp.size || comp.employees || comp.employee_range || '';
            const country = comp.country || comp.location || '';
            const source  = comp.source || identification.source || 'spotter';

            const set = (id, val) => {
                const el = document.getElementById(id);
                if (el && val != null) el.value = val;
            };

            set('snitcher_company_name',    name);
            set('snitcher_company_domain',  domain);
            set('snitcher_company_industry',industry);
            set('snitcher_company_size',    size);
            set('snitcher_company_country', country);
            set('snitcher_spotter_source',  source);

            addToLog(`Spotter populated: ${name || domain || 'unknown'}`);
            updateStatus('Company data loaded');
        }

        async function fetchSpotterIdentification() {
            if (!window.Snitcher?.getSpotterIdentification) return null;
            try {
                const ident = await window.Snitcher.getSpotterIdentification();
                console.log('fetchSpotterIdentification →', ident);
                if (ident?.success) {
                    populateSpotterFieldsFromIdentification(ident);
                }
                return ident;
            } catch (err) {
                console.warn('getSpotterIdentification error:', err);
                return null;
            }
        }

        function initSpotterEnrichment() {
            if (window.Snitcher?.ready) {
                window.Snitcher.ready(() => fetchSpotterIdentification());
            } else {
                let attempts = 0;
                const interval = setInterval(() => {
                    attempts++;
                    if (window.Snitcher?.getSpotterIdentification) {
                        clearInterval(interval);
                        fetchSpotterIdentification();
                    }
                    if (attempts > 12) clearInterval(interval);
                }, 400);
            }
        }

        // Debug button
        function logSpotterDebug() {
            console.log('Debug: requesting Spotter now');
            fetchSpotterIdentification().then(ident => {
                console.log('Spotter result (debug):', ident);
                console.log('Current hidden fields:', {
                    name:    document.getElementById('snitcher_company_name')?.value    || '(empty)',
                    domain:  document.getElementById('snitcher_company_domain')?.value  || '(empty)',
                    industry:document.getElementById('snitcher_company_industry')?.value|| '(empty)',
                    size:    document.getElementById('snitcher_company_size')?.value    || '(empty)',
                    country: document.getElementById('snitcher_company_country')?.value || '(empty)',
                    source:  document.getElementById('snitcher_spotter_source')?.value  || '(empty)'
                });
            });
        }

        // Initialize
        initSpotterEnrichment();

        // ──────────────────────────────────────────────
        // Form submit handler with long wait for Spotter
        // ──────────────────────────────────────────────
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('signupForm');
            if (!form) return;

            function validateEmail(email) {
                return /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@(([^<>()[\]\\.,;:\s@"]+\.)+[^<>()[\]\\.,;:\s@"]{2,})$/i.test(email);
            }

            function validatePassword(pw) {
                return /(?=.{8,})(?=.*[A-Za-z])(?=.*\d)/.test(pw);
            }

            function showFieldError(id, msg) {
                const input = document.getElementById(id);
                const err = document.getElementById(id + 'Error');
                if (input) input.classList.add('invalid');
                if (err) { err.textContent = msg; err.classList.add('visible'); }
            }

            function clearFieldError(id) {
                const input = document.getElementById(id);
                const err = document.getElementById(id + 'Error');
                if (input) input.classList.remove('invalid');
                if (err) err.classList.remove('visible');
            }

            form.addEventListener('submit', async function(e) {
                e.preventDefault();

                ['fullname','email','password'].forEach(clearFieldError);

                updateStatus('Waiting for company enrichment (max ~7s)...');

                // ─── Aggressive wait for Spotter ───────────────────────
                const MAX_WAIT_MS = 7000;
                const start = Date.now();

                while (Date.now() - start < MAX_WAIT_MS) {
                    const name   = document.getElementById('snitcher_company_name')?.value;
                    const domain = document.getElementById('snitcher_company_domain')?.value;

                    if (name || domain) break;

                    if (window.Snitcher?.getSpotterIdentification) {
                        await fetchSpotterIdentification().catch(() => {});
                    }

                    await new Promise(r => setTimeout(r, 600));
                }

                // ─── Now read values ───────────────────────────────────
                const fullname = document.getElementById('fullname').value.trim();
                const email    = document.getElementById('email').value.trim();
                const password = document.getElementById('password').value;

                let valid = true;
                if (!fullname) { showFieldError('fullname', 'Please enter your name.'); valid = false; }
                if (!validateEmail(email)) { showFieldError('email', 'Please enter a valid email address.'); valid = false; }
                if (!validatePassword(password)) { showFieldError('password', 'Please create a strong password (8+ chars, letter + number).'); valid = false; }

                if (!valid) {
                    addToLog('Form validation failed', 'error');
                    updateStatus('Please correct the errors above');
                    return;
                }

                // Build payload
                const payload = {
                    form_name: 'signup_form',
                    form_id: 'signup_01',
                    fullname,
                    email,
                    submitted_at: new Date().toISOString(),
                    company: {
                        name:    document.getElementById('snitcher_company_name')?.value    || '',
                        domain:  document.getElementById('snitcher_company_domain')?.value  || '',
                        industry:document.getElementById('snitcher_company_industry')?.value|| '',
                        size:    document.getElementById('snitcher_company_size')?.value    || '',
                        country: document.getElementById('snitcher_company_country')?.value || '',
                        source:  document.getElementById('snitcher_spotter_source')?.value  || 'unknown'
                    }
                };

                // Debug logs – very important for you right now
                console.log('FORM PAYLOAD (before tracking):', payload);
                console.log('Hidden Spotter fields at submit time:', {
                    name:    document.getElementById('snitcher_company_name')?.value    || '(empty)',
                    domain:  document.getElementById('snitcher_company_domain')?.value  || '(empty)',
                    industry:document.getElementById('snitcher_company_industry')?.value|| '(empty)',
                    size:    document.getElementById('snitcher_company_size')?.value    || '(empty)',
                    country: document.getElementById('snitcher_company_country')?.value || '(empty)',
                    source:  document.getElementById('snitcher_spotter_source')?.value  || '(empty)'
                });

                // Track to Snitcher
                if (window.Snitcher?.track) {
                    try {
                        window.Snitcher.track('Form Submitted', payload);
                        addToLog('Form submitted & tracked to Snitcher');
                        updateStatus('Form tracked (company data included if available)');
                    } catch (err) {
                        console.error('Snitcher track error:', err);
                        addToLog('Tracking error: ' + err.message, 'error');
                    }
                } else {
                    addToLog('Snitcher not ready – form captured locally', 'error');
                }

                // Reset form (no backend in your case)
                form.reset();
            });
        });

        // Snitcher ready check
        if (window.Snitcher?.ready) {
            window.Snitcher.ready(() => {
                updateStatus('Snitcher initialized');
                addToLog('Snitcher ready');
            });
        }

        window.addEventListener('load', renderEventLog);
    </script>
</body>
</html>
